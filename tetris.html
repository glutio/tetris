<html>
<head>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
<style>

table {
   margin:auto;
   border-spacing: 0px;
}  
v *{
 border: 1px solid red;
}

#layout {
  width:100%
}

#wrap {
   position:relative;
}

#next-well {
  position: absolute;
  left: 2%;
  top: 5%;
}

#next-well .shape 
{
  box-shadow: 1px 1px 1px 0px rgba(0, 0, 0, 0.5);
  opacity:0.5;
}

#elapsed,
#sidebar {
  position:absolute;
  right: 2%;
  top: 5%;
  text-align:center;
  font-family:monospace;
  font-size: 20px;
  font-weight:bold;
  color:rgba(40, 40, 40, 0.5);;
  text-shadow: 1px 1px 6px rgba(50, 50, 50, 0.4);
}

#elapsed {
  top: 20%;
}
.tetris td {
    background-color: #ffdae1;
    border-width: 0.5;
    border-style: outset;
}

.well td.nonempty {
    border-width: 0.5;
    border-style: outset;
    width: 12px;
    height: 12px;
}

.well td.nonempty,
{
    background-color: green;
}
 
 .well td.nonempty.shape {
    background-color: blue;
 }
 
 .well td.nonempty[data-color="B"]
 {
  background-color:blue;
 }
 .well td.nonempty[data-color="I"]
 {
  background-color:red;
 }
 .well td.nonempty[data-color="T"]
 {
  background-color:darkorange;
 }
 .well td.nonempty[data-color="LL"]
 {
  background-color:gray;
 }
 .well td.nonempty[data-color="RL"]
 {
  background-color:magenta;
 }
 .well td.nonempty[data-color="LS"]
 {
  background-color:darkcyan;
 }
 .well td.nonempty[data-color="RS"]
 {
   background-color:green;
 }
 .well td.nonempty[data-color="DOT"]
 {
  background-color:darkmagenta;
 }
 .well td.nonempty[data-color="TAK"]
 {
   background-color:black;
   animation: colorchange 5s infinite; /* animation-name followed by duration in seconds*/
         /* you could also use milliseconds (ms) or something like 2.5s */
   -webkit-animation: colorchange 5s infinite; /* Chrome and Safari */
    -webkit-animation-direction: alternate; /* Safari 4.0 - 8.0 */
    animation-direction: alternate;
 }
 
@keyframes colorchange {
      0%   {background: #a79019;}
      25%  {background: #dfbb03;}
      50%  {background: #f8d62d;}
      75%  {background: #ffb400;}
      100% {background: #ff6c00;}
}

 .well td.nonempty[data-color="H"]
 {
   background-color:deeppink;
 }

#above-side-control {
   height: 30%;
}

#bottom-control {
  display:none;
}

#side-control {
  display:none;  
}

#side-control-wrap {
  text-align:right;
}

#control {
  border-spacing:15px;
  margin:auto;
  text-align:center;
} 

#control td {
    margin-left:10px;
    margin-right:10px;
    margin-top:10px;
    width: 60px;
    height: 60px;
    background-position:center;
    background-repeat: no-repeat;    
    background-size: 60px 60px;
 }

#again {
    display:none;
    text-align:center;
    position:absolute;
    left:0;
    right:0;
    top:10%;
    bottom:0;
}
#again div {    
    margin:auto;
    font-size:150%;
    background: rgba(247, 239, 215, 0.9); 
    color: rgba(148, 106, 80, 0.9);
    text-shadow:3px -4px 7px rgba(199,199,199,0.8);
    border: dotted #b5a759;
    text-align:center;
    font-family:serif;
    font-weight: bold;
    box-shadow: 2px -2px 20px 2px rgba(0, 0, 0, 0.46);
}
#again div p {
  padding:0;
  margin:2%px;
  width:100%
}    


 #right {
    background:url(data:image/png;base64,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);
 }
 #left {
    background:url(data:image/png;base64,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);
 }
 #rotate {
    background:url(data:image/png;base64,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);
        -moz-transform: scaleX(-1);
        -o-transform: scaleX(-1);
        -webkit-transform: scaleX(-1);
        transform: scaleX(-1);
        filter: FlipH;
        -ms-filter: "FlipH";
 }
 #drop {
    background:url(data:image/png;base64,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);
 }

</style>
</head>
<body>
<table id="layout"> 
   <tr>
     <td rowspan="2" id="wrap-wrap">
      <div id="wrap">
         <table id="well" class="well tetris" tabindex="1" ></table>
         <table id="next-well" class="well"></table>
         <div id="sidebar"></div>
	 <div id="elapsed"></div>
         <div id="again">
           <div>Again!</div>
         </div>
      </div>
     </td>
     <td id="above-side-control">
     </td>
  </tr>  
  <tr>
     <td id="side-control-wrap">
        <div id="side-control"></div>
     </td>    
  </tr>
  <tr>
    <td id="bottom-control" colspan=2>
      <table id="control">
        <tr>
          <td id="left">Left</td>
          <td id="rotate"></td>
          <td id="right"></td>
        </tr>
        <tr>
          <td></td>
          <td id="drop"></td>
          <td></td>
        </tr>
      </table>               
    </td>
 </tr>
</table>

<!--<script src="tetris.js" /></script> -->
<script>
var wellSize = { width: 10, height: 20 }
var nextShp = 0;
var nextR = 0;
var nextCur = 0;
var cur = 0;
var shp=0;
var r=0;
var pt = { x:0, y:0 };
var spd = 800;            
var timer;
var score = 0;
var shapes = {

B:[{org:{x:0,y:0}, s:`
**
**`}],
I:[{org:{x:2,y:0}, s: `
****`},{org:{x:0,y:1}, s:`
*
*
*
*`
}],
LL:[{org:{x:0, y:0}, s:`
 *
 *
**`},{org:{x:0, y:-1}, s:`
***
  *`},{org:{x:-1, y:0}, s:`
**
*
*`},{org:{x:0, y:0}, s:`
*
***`
}],
RL:[{org:{x:-1,y:0}, s:`
*
*
**`},{org:{x:0,y:0}, s:`
  *
***`},{org:{x:0,y:0}, s:`
**
 *
 *`},{org:{x:0,y:-1}, s:`
***
*`
}],
T:[{org:{x:0,y:-1}, s:`
***
 *`},{org:{x:-1,y:0}, s:`
*
**
*`},{org:{x:0,y:0}, s:`
 *
***`},{org:{x:0,y:0}, s:`
 *
**
 *`}],
LS:[{org:{x:-1,y:1}, s:`
*
**
 *`},{org:{x:0,y:0}, s:`
 **
**`}],
RS:[{org:{x:-1,y:0}, s:`
 *
**
*`},{org:{x:0,y:-1}, s:`
**
 **`}],
DOT:[{org:{x:0,y:0}, s:`
*`}],
TAK:[{org:{x:0,y:0}, s:`
*** ** * *
 *  ** **
 * * * * *`},{org:{x:0,y:0}, s:`
***
 *
 *`},{org:{x:-3,y:0}, s:`
 **
 **
* *`},{org:{x:-7,y:0}, s:`
* *
**
* *`}],
H:[{org:{x:-1,y:-1}, s:`
* *
***
 *`},{org:{x:-1,y:-1}, s:`
* *
***
 *`},{org:{x:0,y:0}, s:`
 * *
*****
 ***
  *`},{org:{x:0,y:0}, s:`
 * *
*****
*****
 ***
  *`},{org:{x:0,y:0}, s:`
 * *
*****
 ***
  *`}/*,{org:{x:0,y:0}, s:`
  **
 ****
****
 ****
  **`}*/]
};

function makeShapes()
{
   for(var p=0; p<Object.keys(shapes).length; p++)
   {
      var key = Object.keys(shapes)[p]; 
      for(var s=0; s<shapes[key].length; s++)
            shapes[key][s].s = makeShape(shapes[key][s].s);
   }
}

function getRandomInt(min, max) {
  min = Math.ceil(min);
  max = Math.floor(max);
  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
}

function nextShape()
{
   var paintShp = nextShp;
   var paintCur = nextCur;

   cur = nextCur;
   shp = nextShp; 
   r = nextR;
   
   var nextWell = $("#next-well");
   _paintShape(nextWell, nextCur, { x:0, y:0 }, Object.keys(shapes)[nextShp], false);
	
   var isAlmostEmpty = getCell(0,15).closest("tr").find("td").closest(".nonempty").length == 0;    
   do {
     nextShp = getRandomInt(0, Object.keys(shapes).length);
     nextR = getRandomInt(0, shapes[Object.keys(shapes)[nextShp]].length);
     nextCur = shapes[Object.keys(shapes)[nextShp]][nextR].s;
     if ((Object.keys(shapes)[nextShp]=="TAK" || Object.keys(shapes)[nextShp]=="H")) {
        if (!isAlmostEmpty) continue;
        paintShp = getRandomInt(0, Object.keys(shapes).length-2);
        paintCur = shapes[Object.keys(shapes)[paintShp]][0].s;
        paintR = 0;             
     }
     else
     {
     	paintShp = nextShp;
        paintCur = nextCur;
        paintR = nextR;
     }     
     break;
   } while (true); 

   var org = shapes[Object.keys(shapes)[paintShp]][paintR].org;
   var height = $("#well ._0_0").height();
   _initWell(nextWell, paintCur[0].length, paintCur.length, height);
   _paintShape(nextWell, paintCur, {x: 0, y: 0}, Object.keys(shapes)[paintShp], true);
}

function makeShape(shape)
{
   var x=0;
   var y=0;
   var maxX=0;
   for(var c=0; c<shape.length; c++)
   {
     if (shape[c]=='\n') { y++; maxX=Math.max(x, maxX); x=0; } else { x++; }
   }
   maxX=Math.max(x, maxX);   
   
   var s=new Array(y);
   y=-1; x=0;
   for(var c=0; c<shape.length; c++)
   {
     if (shape[c]=='\n') { 
	x=0; y++; 
        s[y]=new Array(maxX);
     } 
     else {
        if (shape[c]=='*') s[y][x]=shape[c];
        x++;
     }  
   }
   return s;   
}

function _initWell(well, x, y, size) {
   well.find("tr").each(function() { $(this).remove(); });
   for(var i=0; i<y; i++)
   {
      var tr=$("<tr/>");
      well.append(tr);
      for(var j=0; j<x; j++)
      {   
        var td = $("<td/>");
        td.addClass("_"+i+"_"+j);
        td.attr("data-x",j);
        td.attr("data-y",i);
        tr.append(td);
      }
   }
   well.find("td").css("height", size);
   well.find("td").css("width", size);
}

function initWell() {
   var height = $("body").height();
   if ($("#bottom-control").is(":visible")) {
	height-=$("#bottom-control").height();
   }
   height/=wellSize.height;
   
   var well = $("#well");
   _initWell(well, wellSize.width, wellSize.height, height);

   $("#sidebar").css("font-size", Math.max(6, 1.2*height)+"px");
   $("#elapsed").css("font-size", Math.max(6, 0.8*height)+"px");

   $("#again").css("font-size", Math.max(6, 0.8*height)+"px");
   $("#again div").css("border-width", Math.max(5, 0.5*height)+"px");
} 

function initControl()
{
   $("#left").click(function() { moveShape(-1,0); });
   $("#right").click(function() { moveShape(1,0); });
   $("#rotate").click(function() { rotateShape(); });
   $("#drop").click(function() { dropShape(); });
   $("#well").click(function() { moveShape(0,1); });

   var controlClone = $("#control").clone(true);
   $("#side-control").append(controlClone);
   
   var doc = $(document);
   if (doc.height() >= doc.width()) {
	$("#bottom-control").show();
        //$("#sidebar").hide();
	$("#side-control-wrap").hide();
   } else {
	$("#side-control").css('display', 'inline-block');
   } 
   
   $("#again").click(function() { reset(); });

}

function rotateShape()
{
   if (isCollapsing) return;
   var key = Object.keys(shapes)[shp];
   for(var i=1; i<shapes[key].length; i++) {
      var newR=(r+i)%shapes[key].length;
      var newCur=shapes[key][newR].s;
      var org=shapes[key][newR].org;
      if (isValidPos(newCur, { x: pt.x-org.x, y:pt.y-org.y })) {
         paintShape(false);
         cur=newCur;   
         r=newR;
         paintShape(true);
         break;   
      }
   }
}

function isValidPos(shape, pt)
{
   if (pt.x<0 || pt.x+shape[0].length>wellSize.width) return false;
   if (pt.y+shape.length>wellSize.height) return false;

   for(var y=0; y<shape.length; y++) {                                                                                               
     for(var x=0; x<shape[y].length; x++) {
        var cell = getCell(pt.x+x,pt.y+y);
	if (shape[y][x]=='*' && cell.hasClass("nonempty") && !cell.hasClass("shape")) return false;
     }
   }
   return true;
}

var isCollapsing = false;
function _collapseShape(well)
{
   var result = false;
   var shape = well.find(".shape");
   shape.sort(function(a,b) {
          var y1 = Number($(a).attr("data-y"));
          var y2 = Number($(b).attr("data-y"));
          return (y1<y2) ? 1 : (y1>y2) ? -1 :0;
   }); 
      
   shape.each(function() {
       var cell = $(this);
       if (cell.hasClass("nonempty")) { 
          var x = Number(cell.attr("data-x"));
          var y = Number(cell.attr("data-y"));
          
          var belowCell = _getCell(well, x, y+1);
          if (belowCell.length && !$(belowCell).hasClass("nonempty")) {
	      belowCell.addClass("nonempty").addClass("shape").attr("data-color", cell.attr("data-color")); 
	      cell.removeClass("nonempty").removeClass("shape").removeAttr("data-color");              
              result = true;
          }
      }
   });
   isCollapsing = result;   
   return result;
}

function collapseShape()
{
   var well = $("#well");
   return _collapseShape(well);
}

function changeShape()
{
   paintShape(false);
   shp=(shp+1)%Object.keys(shapes).length;
   r=0;
   var key = Object.keys(shapes)[shp];
   cur=shapes[key][r].s;
   paintShape(true);  
}

$("#well").keydown(function(event) {
	switch(event.originalEvent.code)
        {
           case "ArrowRight": {
		event.preventDefault();
                moveShape(1,0);break;
	   }
           case "ArrowLeft": {
		event.preventDefault();
		moveShape(-1,0);break;
	   }
           case "ArrowUp": {
		event.preventDefault();
                rotateShape();break;
	   }
           case "ArrowDown": {
		event.preventDefault();
                playGame();
                break;
	   }
           case "Space": {    
		if (!inPlay) {
                   reset();
                } else {
                    event.preventDefault();
		    dropShape();
                }
                break;
           }
        }
});


var inPlay=false;
function playGame()
{
    inPlay = true;
    if (!moveShape(0,1)) {                   
        if (Object.keys(shapes)[shp]=="TAK" || Object.keys(shapes)[shp]=="H") {
           if (collapseShape()) return;
        }
        if (pt.y<0)
        {
           clearInterval(timer);
           inPlay = false;
           showResetButton();
           inPlay = false;
           return;
        }
        dropShape();
    };                
}

var elapsedTimer;
function showElapsedTime (startTime) {
    if (!inPlay) return;
    var today = new Date().getTime();
    var m = Math.floor((today-startTime) / (1000*60)) % 60;
    var s = Math.floor((today-startTime) / 1000) % 60;
    //var ss = Math.floor(today-startTime) % 10;
    
    $("#elapsed").text(m + ":" + s.pad(2) /* + "." + ss*/);
    
    elapsedTimer = setTimeout(function() { 
       showElapsedTime(startTime) 
    }, 1000);
}

function checkTime(i) {
    if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    return i;
}

function releaseShape()
{
    var key = Object.keys(shapes)[shp];
    var org = shapes[key][r].org;
    pt.x=Math.floor((wellSize.width-cur[0].length) / 2)+org.x;
    pt.y=-cur.length;                      
}

function dropShape()
{
        if (!inPlay) return;
        while(moveShape(0,1));
        if (Object.keys(shapes)[shp]=="TAK" || Object.keys(shapes)[shp]=="H") {
            while(collapseShape());
        }
        embedShape();
        removeLines();
    	var oldTimer = timer;
    	timer = setInterval(playGame, spd);
    	clearInterval(oldTimer);
        nextShape();
        releaseShape();
        paintShape(true);
        playGame();
}

function showResetButton()
{
   var time = $("#elapsed").text();  
   $("#again div").html("<p>Score <b>"+score+" pts</b></p><p>Time <b>"+time+"</b></p><p>TRY AGAIN!</>");
   $("#again").show();
}

Number.prototype.pad = function(size) {
      var s = String(this);
      while (s.length < (size || 2)) {s = "0" + s;}
      return s;
    }

function _getCell(well, x,y)
{          
   var name = well.find("._"+Number(y)+"_"+Number(x));
   var result = $(name);
   return result;
}

function getCell(x,y) {
  return _getCell($("#well"),x,y);
}


function embedShape()
{
    $("#well .shape").removeClass("shape");
}

function moveShape(dx,dy)
{
   if (isCollapsing) return false;
   var key = Object.keys(shapes)[shp];
   var org = shapes[key][r].org;
   if (!isValidPos(cur, { x: (pt.x+dx)-org.x, y: (pt.y+dy)-org.y })) return false;
   paintShape(false);
   pt.x+=dx;
   pt.y+=dy;
   paintShape(true);
   return true;
}

function removeLines()
{  
   var ctLines = 0;
   var lineScore = 0;
   var key = Object.keys(shapes)[shp];
   var org = shapes[key][r].org;   
      
   var bottomShapeBlock = 0; 	
   $("#well td.shape").each(function() { bottonShapeBlock = Math.max(bottomShapeBlock, Number($(this).attr("data-y"))); });	
   //pt.y+cur.length-1-org.y
   for(var yy=wellSize.height-1 ;yy>=0;yy--)
   {
      var line = getCell(0, yy).closest("tr").find("td");
      var blocks = line.closest(".nonempty");
      if (blocks.length==0) break; 
      if (blocks.length==wellSize.width)
      {
         blocks.each(function() { lineScore += Math.max(0, Object.keys(shapes).indexOf($(this).attr("data-color"))); });
         ctLines++;
         var lineAbove;
         for(var y=yy;y>0; y--)
         {
            var lineAbove = getCell(0, y-1).closest("tr").find("td");                  
  	    var blanks = blocks-lineAbove.closest(".nonempty").length;
            for(var c=0; c<wellSize.width; c++) {
              if ($(lineAbove[c]).hasClass("nonempty")) {
                 $(line[c]).addClass("nonempty");              
                 $(line[c]).attr("data-color",$(lineAbove[c]).attr("data-color"));              
              }
              else {                 
                 $(line[c]).removeClass("nonempty"); 
                 $(line[c]).removeAttr("data-color");              
              }           
            }
            line=lineAbove;
            if (blanks==blocks) break;
         }
         yy++; 
      }
   }
   if (!lineScore) lineScore = 1;
   if (ctLines==4) lineScore*=2;
   score += lineScore;
   $("#sidebar").text(score.pad(4));
}

function _paintShape(well, shape, org, color, show)
{
  for(var y=0; y< shape.length; y++)
     for(var x=0; x< shape[y].length; x++) 
	if (shape[y][x]=='*') {
	    var cell = _getCell(well, (org.x+x),(org.y+y)) 
	    if (show) cell.addClass("nonempty").addClass("shape").attr("data-color",color); 
		else cell.removeClass("nonempty").removeClass("shape").attr("data-color","");
        } 
}

function paintShape(on)
{
   var key = Object.keys(shapes)[shp];
   var org = shapes[key][r].org;
   _paintShape($("#well"), cur, { x: pt.x-org.x, y:pt.y-org.y }, key, on);
}

function reset()
{
    $("#again").hide();   
    clearInterval(timer);
    clearTimeout(elapsedTimer);
    $("#well .nonempty").removeClass("nonempty").removeClass("shape");
    score = 0;
    $("#sidebar").text(score.pad(4));  
    nextShape();                          
    /*shp=Object.keys(shapes).indexOf("TAK");    
    r = 0;
    cur = shapes["TAK"][r].s;*/
    releaseShape();
    spd = 1000;        
    timer = setInterval(playGame, spd);                                   
    inPlay = true;
    showElapsedTime(new Date().getTime());
    $("#well").focus();
    
}

makeShapes();
initControl();
initWell();
nextShape();
paintShape(true);
reset();
setInterval(function() {
    spd=Math.max(0,spd-10);
}, 10000);
</script>

</body>
</html>